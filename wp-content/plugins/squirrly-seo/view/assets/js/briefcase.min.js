if(typeof SQ_DEBUG==="undefined"){var SQ_DEBUG=false}(function(b){var a;b.fn.sq_Briefcase=function(){var f=this;var c=f.find(".sq_add_keyword_dialog");var d=f.find(".sq_add_labels_dialog");var e=f.find(".sq_edit_label_dialog");f.listenAdd=function(){d.find("#sq_labelcolor").wpColorPicker();d.find("#sq_save_label").on("click",function(){var g=b(this);var i=d.find("input#sq_labelname").val();var h=d.find("input#sq_labelcolor").val();g.addClass("sq_minloading");b.post(sqQuery.ajaxurl,{action:"sq_briefcase_addlabel",name:i,color:h,sq_nonce:sqQuery.nonce}).done(function(j){if(typeof j.saved!=="undefined"){location.reload();g.removeClass("sq_minloading")}else{if(typeof j.error!=="undefined"){g.removeClass("sq_minloading");b.sq_showMessage(j.error).addClass("sq_error")}}}).fail(function(){g.removeClass("sq_minloading")},"json")});f.find(".sq_save_keyword_labels").on("click",function(){var i=b(this).parents(".sq_label_manage_popup:last");var h=b(this);var j=b(this).data("keyword");var g=[];i.find('input[name="sq_labels"]:checked').each(function(){g.push(this.value)});h.addClass("sq_minloading");b.post(sqQuery.ajaxurl,{action:"sq_briefcase_keywordlabel",keyword:j,labels:g,sq_nonce:sqQuery.nonce}).done(function(k){if(typeof k.saved!=="undefined"){location.reload();h.removeClass("sq_minloading")}else{if(typeof k.error!=="undefined"){h.removeClass("sq_minloading");b.sq_showMessage(k.error).addClass("sq_error")}}}).fail(function(){h.removeClass("sq_minloading")},"json")})};f.listenEdit=function(){e.find("#sq_labelcolor").wpColorPicker();f.find(".sq_edit_label").on("click",function(){b("#element .wp-picker-clear").trigger("click");e.find("input#sq_labelid").val(b(this).attr("data-id"));e.find("input#sq_labelname").val(b(this).attr("data-name"));e.find("input#sq_labelcolor").val(b(this).attr("data-color"));e.find("input#sq_labelcolor").trigger("change");c.modal("hide");d.modal("hide");e.modal("show")});e.find("#sq_save_label").on("click",function(){var g=b(this);var h=e.find("#sq_labelid").val();var j=e.find("#sq_labelname").val();var i=e.find("#sq_labelcolor").val();g.addClass("sq_minloading");b.post(sqQuery.ajaxurl,{action:"sq_briefcase_editlabel",id:h,name:j,color:i,sq_nonce:sqQuery.nonce}).done(function(k){if(typeof k.saved!=="undefined"){location.reload();g.removeClass("sq_minloading")}else{if(typeof k.error!=="undefined"){g.removeClass("sq_minloading");b.sq_showMessage(k.error).addClass("sq_error")}}}).fail(function(){g.removeClass("sq_minloading")},"json")})};f.listenCount=function(){f.find(".sq_open_subrow").on("click",function(){var g=b(this);var h=b(this).data("id");var i=b(this).data("keyword");f.find(".fa_showmore").removeClass("fa-sort-asc");if(b("#sq_subrow_"+h).is(":visible")){b("#sq_subrow_"+h).hide();return}g.addClass("sq_minloading");b.post(sqQuery.ajaxurl,{action:"sq_briefcase_article",keyword:i,sq_nonce:sqQuery.nonce}).done(function(j){if(typeof j.error!=="undefined"){if(j.error==="limit_exceeded"){b.sq_showMessage(j.error).addClass("sq_error")}else{b.sq_showMessage(j.error,10000).addClass("sq_error")}}else{if(typeof j.articles!=="undefined"){b(".sq_subrow").hide();b("#sq_subrow_"+h).find("td").html(j.articles);b("#sq_subrow_"+h).show()}}b("#sq_row_"+h).find(".fa_showmore").addClass("fa-sort-asc");g.removeClass("sq_minloading")}).fail(function(){g.removeClass("sq_minloading")},"json")})};f.listenDelete=function(){f.find(".sq_delete").on("click",function(){if(confirm("Are you sure ?")){var g=b(this);var i=b(this).data("keyword");var h=b(this).data("id");g.addClass("sq_minloading");b.post(sqQuery.ajaxurl,{action:"sq_briefcase_deletekeyword",keyword:i,sq_nonce:sqQuery.nonce}).done(function(j){if(typeof j.message!=="undefined"){f.find("#sq_row_"+h).remove();f.find("#sq_subrow_"+h).remove()}else{if(typeof j.error!=="undefined"){b.sq_showMessage(j.error).addClass("sq_error")}}g.removeClass("sq_minloading")}).fail(function(){g.removeClass("sq_minloading")},"json")}});f.find(".sq_delete_label").on("click",function(){if(confirm("Are you sure ?")){var g=b(this).parents(".sq_saved_label:last");var h=b(this).data("id");g.addClass("sq_minloading");b.post(sqQuery.ajaxurl,{action:"sq_briefcase_deletelabel",id:h,sq_nonce:sqQuery.nonce}).done(function(i){if(typeof i.deleted!=="undefined"){location.reload();g.remove();f.find("label[data-id="+h+"]").remove();f.find(".sq_circle_label[data-id="+h+"]").remove()}else{if(typeof i.error!=="undefined"){b.sq_showMessage(i.error).addClass("sq_error")}}g.removeClass("sq_minloading")}).fail(function(){g.removeClass("sq_minloading")},"json")}})};f.listenDoSerp=function(){f.find(".sq_research_doserp").on("click",function(){var g=b(this);var h=b(this).data("keyword");g.addClass("sq_minloading");b.post(sqQuery.ajaxurl,{action:"sq_ajax_briefcase_doserp",keyword:h,sq_nonce:sqQuery.nonce}).done(function(i){if(typeof i.message!=="undefined"){b.sq_showMessage(i.message).addClass("sq_success");g.hide()}else{if(typeof i.error!=="undefined"){b.sq_showMessage(i.error)}}g.removeClass("sq_minloading")}).fail(function(){g.removeClass("sq_minloading")},"json")})};f.listenOptions=function(){f.find(".sq_research_selectit").on("click",function(){b(this).addClass("sq_minloading");var g=b(this).data("keyword");b.sq_setCookie("sq_keyword",g);location.href=b(this).data("post")});b("#sq_briefcase .sq_filter_label input[type=checkbox]").click(function(){b("#sq_briefcase .sq_filter_label input[type=checkbox]").each(function(){if(!b(this).is(":checked")){b(this).next("label").removeClass("sq_active")}});if(b(this).is(":checked")){b(this).next("label").addClass("sq_active")}});b("#sq_briefcase .sq_add_keyword_dialog input[type=checkbox]").click(function(){b("#sq_briefcase .sq_add_keyword_dialog input[type=checkbox]").each(function(){if(!b(this).is(":checked")){b(this).next("label").removeClass("sq_active")}});if(b(this).is(":checked")){b(this).next("label").addClass("sq_active")}});b("#sq_briefcase .sq_label_manage_popup input[type=checkbox]").click(function(){var g=b(this).parents(".sq_label_manage_popup:last");g.find("input[type=checkbox]").each(function(){if(!b(this).is(":checked")){b(this).next("label").removeClass("sq_active")}});if(b(this).is(":checked")){b(this).next("label").addClass("sq_active")}})};f.bulkAction=function(){f.find(".sq_bulk_submit").on("click",function(){var i=b(this);if(f.find(".sq_bulk_action").find(":selected").val()!==""){if(!i.hasClass("btn-modal")&&f.find(".sq_bulk_action").find(":selected").val()==="sq_ajax_briefcase_bulk_label"){f.find("#sq_label_manage_popup_bulk").modal("show");return}if(f.find(".sq_bulk_action").find(":selected").data("confirm")){if(!confirm(f.find(".sq_bulk_action").find(":selected").data("confirm"))){return}}var h=[];jQuery(f.find(".sq_bulk_input").serializeArray()).each(function(){h.push(b(this).attr("value"))});var g=[];jQuery(f.find(".sq_bulk_labels").serializeArray()).each(function(){g.push(b(this).attr("value"))});i.addClass("sq_minloading");b.post(sqQuery.ajaxurl,{action:f.find(".sq_bulk_action").find(":selected").val(),inputs:h,labels:g,sq_nonce:sqQuery.nonce}).done(function(j){if(typeof j.message!=="undefined"){b.sq_showMessage(j.message).addClass("sq_success");if(f.find(".sq_bulk_action").find(":selected").val()==="sq_ajax_briefcase_bulk_doserp"){f.find(".sq_bulk_input").each(function(){if(b(this).is(":checked")){b(this).parents("tr:last").find(".sq_research_doserp").remove();b(this).prop("checked",false)}})}else{if(f.find(".sq_bulk_action").find(":selected").val()==="sq_ajax_briefcase_bulk_delete"){f.find(".sq_bulk_input").each(function(){if(b(this).is(":checked")){a.row(b(this).parents("tr:last")).remove().draw()}})}else{location.reload()}}}else{if(typeof j.error!=="undefined"){b.sq_showMessage(j.error)}}i.removeClass("sq_minloading")}).fail(function(){i.removeClass("sq_minloading")},"json")}})};f.listenAdd();f.listenEdit();f.listenDelete();f.listenDoSerp();f.listenOptions();f.bulkAction();return f};b.fn.loadTable=function(){b.extend(b.fn.dataTableExt.oSort,{"formatted-progress-pre":function(c){return b("<div></div>").append(c).find("button").data("value")},"formatted-progress-asc":function(d,c){return d-c},"formatted-progress-desc":function(d,c){return c-d},"formatted-num-pre":function(c){return parseInt(c.replace(/[^\d\-\.]/g,""))},"formatted-num-asc":function(d,c){return d-c},"formatted-num-desc":function(d,c){return c-d}});return b(this).DataTable({columnDefs:[{targets:4,sortable:true,type:"formatted-progress"},{targets:2,sortable:true,type:"formatted-num"},{targets:[0,5],sortable:false}],bPaginate:true,bLengthChange:false,bFilter:false,iDisplayLength:10,aaSorting:[2,"desc"]})};b(document).ready(function(){b("#sq_briefcase").sq_Briefcase();b("#sq_briefcaselabels").sq_Briefcase();a=b("#sq_briefcase table.table").loadTable()})})(jQuery);